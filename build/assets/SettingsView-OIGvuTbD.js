import{c as g,j as e,U as Me,x as H,T as B,D as Se,r as b,g as V,d as te,P as de,X as T,y as _e,z as q,A as Re,h as W,n as ae,B as $e,E as Ae,l as Ie,b as re,e as le,F as ne,t as Te}from"./index-Dtw_p8OJ.js";import{P as Le,G as ie}from"./pen-Bvo4yrs_.js";import{C as k}from"./chevron-right-BiC0KxO7.js";import{R as Ee}from"./repeat-C5Ip0jav.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],Pe=g("arrow-down",Oe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M8 3 4 7l4 4",key:"9rb6wj"}],["path",{d:"M4 7h16",key:"6tx8e3"}],["path",{d:"m16 21 4-4-4-4",key:"siv7j2"}],["path",{d:"M20 17H4",key:"h6l3hr"}]],Ue=g("arrow-left-right",Fe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],qe=g("arrow-up",Ve);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],We=g("copy",He);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]],Ge=g("database",Be);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Ke=g("file-text",Xe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],oe=g("layout-grid",Qe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Je=g("log-out",Ye);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=[["path",{d:"M12 22a1 1 0 0 1 0-20 10 9 0 0 1 10 9 5 5 0 0 1-5 5h-2.25a1.75 1.75 0 0 0-1.4 2.8l.3.4a1.75 1.75 0 0 1-1.4 2.8z",key:"e79jfc"}],["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}]],De=g("palette",Ze);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],ss=g("pencil",es);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],as=g("rotate-ccw",ts);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],ls=g("share-2",rs);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],is=g("shield-alert",ns);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ce=g("triangle-alert",os);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],ds=g("user-x",cs);function xs({ledgerData:n,user:r,isHost:o,kickMember:c}){return n!=null&&n.users?e.jsxs("div",{className:"border-t border-gray-50 p-4 bg-gray-50/50",children:[e.jsxs("h4",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-3 flex items-center gap-2",children:[e.jsx(Me,{size:12})," 帳本成員"]}),e.jsx("div",{className:"space-y-3",children:Object.keys(n.users).map(x=>{const m=n.users[x],j=x===r.uid,N=m.role||"guest";return e.jsxs("div",{className:"flex items-center gap-3",children:[H(m.avatar,"w-8 h-8"),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-bold text-sm ${j?"text-gray-900":"text-gray-600"}`,children:m.name}),j&&e.jsx("span",{className:"text-[10px] text-gray-400 bg-gray-200 px-1.5 rounded-full",children:"(我)"})]})}),e.jsx("span",{className:`text-[10px] font-bold px-2 py-1 rounded-full ${N==="host"?"bg-rose-50 text-rose-600":"bg-gray-200 text-gray-500"}`,children:N==="host"?"戶長":"成員"}),o&&!j&&e.jsx("button",{onClick:()=>c(x),className:"p-2 bg-gray-100 text-gray-400 rounded-full hover:bg-rose-50 hover:text-rose-500 transition-colors",children:e.jsx(B,{size:14})})]},x)})})]}):null}function ms({ledgerData:n,isEditingCategory:r,setIsEditingCategory:o,editingCategoryData:c,setEditingCategoryData:x,handleSaveCategory:m,handleDeleteCategory:j,handleReorderCategories:N}){const w=(n==null?void 0:n.customCategories)||Se,[y,a]=b.useState(!1),[l,d]=b.useState(null),p=t=>{if(!l)d(t);else{if(l===t){d(null);return}const f=w.findIndex(M=>M.id===l),h=w.findIndex(M=>M.id===t);if(f===-1||h===-1)return;const u=[...w],[z]=u.splice(f,1);u.splice(h,0,z),N(u),d(null)}},L=()=>{x({id:"",name:"",icon:"food",colorId:"slate"}),o(!0)},E=t=>{x(t),o(!0)},O=()=>{o(!1),m()},P=t=>{o(!1),j(t)};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-sm font-bold text-gray-400 flex items-center gap-2",children:[e.jsx(oe,{size:16})," 分類管理"]}),e.jsxs("button",{onClick:()=>{a(!y),d(null)},className:`text-xs font-bold px-3 py-1.5 rounded-full transition-all flex items-center gap-1 ${y?"bg-rose-500 text-white shadow-md":"bg-gray-100 text-gray-500 hover:bg-gray-200"}`,children:[e.jsx(Ue,{size:12})," ",y?"完成":"排序"]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-2 sm:gap-3",children:[w.map(t=>{const f=V(t.icon),h=l===t.id,u=te(t,"input"),z=y?{animation:`wiggle 0.3s ease-in-out infinite ${Math.random()*.5}s`}:{};return e.jsxs("button",{style:z,onClick:()=>y?p(t.id):E(t),className:`flex flex-col items-center gap-1 group relative transition-all duration-300 ${h?"scale-110 z-10":"active:scale-95"}`,children:[e.jsx("div",{className:`
                                        w-12 h-12 rounded-2xl flex items-center justify-center transition-all shadow-sm border
                                        ${h?u.activeClass:u.containerClass}
                                        ${h?"shadow-lg":""}
                                    `,children:e.jsx(f,{size:20,className:h?"text-white":u.iconClass})}),e.jsx("span",{className:"text-[10px] font-medium text-gray-500 truncate w-full text-center",children:t.name})]},t.id)}),!y&&e.jsxs("button",{onClick:L,className:"flex flex-col items-center gap-1 group active:scale-95 transition-transform",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gray-50 border border-dashed border-gray-300 flex items-center justify-center text-gray-400 group-hover:border-rose-300 group-hover:text-rose-500 transition-colors",children:e.jsx(de,{size:20})}),e.jsx("span",{className:"text-[10px] font-medium text-gray-400",children:"新增"})]})]}),e.jsx("style",{children:`
                @keyframes wiggle {
                    0% { transform: rotate(0deg); }
                    25% { transform: rotate(-2deg); }
                    75% { transform: rotate(2deg); }
                    100% { transform: rotate(0deg); }
                }
            `}),r&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-end sm:items-center justify-center sm:px-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity",onClick:()=>o(!1)}),e.jsxs("div",{className:"bg-white w-full sm:max-w-md sm:rounded-3xl rounded-t-3xl shadow-2xl relative z-10 flex flex-col max-h-[90vh] animate-slide-up",children:[e.jsxs("div",{className:"bg-white px-6 py-4 flex justify-between items-center border-b border-gray-100 rounded-t-3xl",children:[e.jsx("h3",{className:"font-bold text-gray-800 text-lg",children:c.id?"編輯分類":"新增分類"}),e.jsx("button",{onClick:()=>o(!1),className:"p-2 bg-gray-50 rounded-full text-gray-400 hover:text-gray-600",children:e.jsx(T,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-6 overflow-y-auto",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[(()=>{const t=te(c,"display");return e.jsx("div",{className:`w-20 h-20 rounded-3xl flex items-center justify-center shadow-xl transition-colors ${t.containerClass}`,style:t.containerStyle,children:_e.createElement(V(c.icon),{size:36,className:t.iconClass,style:t.iconStyle})})})(),e.jsx("span",{className:"font-bold text-gray-800",children:c.name||"分類名稱"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2",children:"名稱"}),e.jsx("input",{type:"text",value:c.name,onChange:t=>x({...c,name:t.target.value}),className:"w-full bg-gray-50 text-gray-900 font-bold py-3 px-4 rounded-xl outline-none border-2 border-transparent focus:border-rose-500 transition-colors",placeholder:"輸入分類名稱..."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2 flex items-center gap-2",children:[e.jsx(De,{size:12})," 顏色"]}),e.jsx("div",{className:"flex gap-3 overflow-x-auto pb-2 p-3 no-scrollbar",children:q.map(t=>{var f;return e.jsx("button",{onClick:()=>{var h;t.id||Object.keys(q).find(u=>q[u].hex===t.hex),x({...c,colorId:((h=t.name)==null?void 0:h.toLowerCase())||"slate"})},className:`w-10 h-10 rounded-full shrink-0 transition-transform ${c.colorId===((f=t.name)==null?void 0:f.toLowerCase())?"ring-4 ring-offset-2 ring-gray-200 scale-110":"hover:scale-105"}`,style:{backgroundColor:t.hex}},t.hex)})})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-bold text-gray-400 uppercase mb-2 flex items-center gap-2",children:[e.jsx(oe,{size:12})," 圖示"]}),e.jsx("div",{className:"grid grid-cols-5 gap-3 max-h-40 overflow-y-auto p-1",children:Re.map(t=>{const f=V(t),h=c.icon===t;return e.jsx("button",{onClick:()=>x({...c,icon:t}),className:`w-12 h-12 rounded-xl flex items-center justify-center transition-all ${h?"bg-gray-900 text-white shadow-lg scale-105":"bg-gray-50 text-gray-400 hover:bg-gray-100"}`,children:e.jsx(f,{size:20})},t)})})]})]}),e.jsxs("div",{className:"p-4 border-t border-gray-100 flex gap-3 bg-white pb-[calc(env(safe-area-inset-bottom)+1rem)] rounded-b-3xl",children:[c.id&&e.jsx("button",{onClick:()=>P(c.id),className:"p-4 bg-gray-50 text-gray-400 rounded-2xl hover:bg-red-50 hover:text-red-500 transition-colors",children:e.jsx(B,{size:20})}),e.jsxs("button",{onClick:O,disabled:!c.name,className:"flex-1 bg-gray-900 text-white font-bold py-4 rounded-2xl shadow-lg shadow-gray-200 active:scale-95 transition-transform disabled:opacity-50 disabled:shadow-none flex items-center justify-center gap-2",children:[e.jsx(W,{size:20})," 儲存變更"]})]})]})]})]})}function hs({ledgerData:n,updatePaymentMethods:r}){const o=(n==null?void 0:n.paymentMethods)||[],[c,x]=b.useState(!1),[m,j]=b.useState({id:"",name:""}),N=(a,l)=>{const d=[...o],p=l==="up"?a-1:a+1;p<0||p>=d.length||([d[a],d[p]]=[d[p],d[a]],r(d))},w=a=>{if(!window.confirm("確定要刪除此支付方式嗎？"))return;const l=o.filter(d=>d.id!==a);r(l)},y=()=>{if(!m.name.trim())return;let a=[...o];m.id?a=a.map(l=>l.id===m.id?{...l,name:m.name}:l):a.push({id:$e(),name:m.name}),r(a),x(!1),j({id:"",name:""})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 flex justify-between items-center active:bg-gray-50 transition-colors cursor-pointer",onClick:()=>x(!0),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 text-gray-600 rounded-lg",children:e.jsx(ae,{size:18})}),e.jsx("span",{className:"font-bold text-gray-700 text-sm",children:"支付方式管理"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[10px] text-gray-400 font-bold",children:[o.length," 組"]}),e.jsx(Le,{size:16,className:"text-gray-300"})]})]}),c&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm px-4",onClick:()=>x(!1),children:e.jsxs("div",{className:"bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl animate-scale-up",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ae,{size:18})," 支付方式管理"]}),e.jsx("button",{onClick:()=>x(!1),className:"p-1.5 bg-gray-50 rounded-full text-gray-400 hover:bg-gray-100",children:e.jsx(T,{size:18})})]}),e.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"設定您的常用支付方式，例如「現金」、「信用卡」、「悠遊卡」等。"}),e.jsxs("div",{className:"space-y-3 max-h-[50vh] overflow-y-auto pr-1 mb-4",children:[o.map((a,l)=>e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-xl border border-gray-100",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("button",{onClick:()=>N(l,"up"),disabled:l===0,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-30 disabled:hover:text-gray-400",children:e.jsx(qe,{size:12})}),e.jsx("button",{onClick:()=>N(l,"down"),disabled:l===o.length-1,className:"p-1 text-gray-400 hover:text-gray-600 disabled:opacity-30 disabled:hover:text-gray-400",children:e.jsx(Pe,{size:12})})]}),e.jsx("input",{value:a.name,onChange:d=>{const p=[...o];p[l].name=d.target.value},onBlur:d=>{const p=[...o];p[l].name=d.target.value,r(p)},className:"flex-1 bg-transparent font-bold text-gray-700 outline-none text-sm"}),e.jsx("button",{onClick:()=>w(a.id),className:"p-2 text-gray-300 hover:text-red-500 transition-colors",children:e.jsx(B,{size:16})})]},a.id)),o.length===0&&e.jsx("div",{className:"text-center py-6 border border-dashed border-gray-200 rounded-xl",children:e.jsx("span",{className:"text-xs text-gray-400",children:"暫無設定"})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{value:m.name,onChange:a=>j({...m,name:a.target.value}),placeholder:"新增項目 (例: LINE Pay)",className:"flex-1 bg-gray-50 px-4 py-3 rounded-xl text-sm font-bold outline-none border border-transparent focus:bg-white focus:border-rose-200",onKeyDown:a=>{a.key==="Enter"&&y()}}),e.jsx("button",{onClick:y,disabled:!m.name,className:"bg-gray-900 text-white p-3 rounded-xl disabled:opacity-50",children:e.jsx(de,{size:20})})]})]})})]})}function vs({user:n,ledgerData:r,isEditingCategory:o,setIsEditingCategory:c,editingCategoryData:x,setEditingCategoryData:m,handleSaveCategory:j,handleDeleteCategory:N,handleExport:w,handleLogout:y,isAvatarModalOpen:a,setIsAvatarModalOpen:l,myNickname:d,setMyNickname:p,updateNickname:L,tempAvatar:E,handleAvatarSelect:O,confirmAvatarUpdate:P,handleFixIdentity:t,ledgerCode:f,updateLedgerCurrency:h,currentProjectId:u,handleReorderCategories:z,setView:M,updateUserSetting:G}){var Y,J,Z,D,ee,se;const{leaveLedger:xe,resetAccount:me,deleteAccount:he,kickMember:ge,updatePaymentMethods:pe,migrateToSubCollection:fe}=Ae();b.useEffect(()=>{window.scrollTo(0,0)},[]);const[X,K]=b.useState(!1),[ye,R]=b.useState(!1),[be,$]=b.useState(!1),[ue,je]=b.useState(!1),[gs,ve]=b.useState(0),F=(Y=r==null?void 0:r.projects)==null?void 0:Y.find(s=>s.id===u),S=(F==null?void 0:F.rates)||{},[A,U]=b.useState(S),C=(((J=r==null?void 0:r.users)==null?void 0:J[n==null?void 0:n.uid])||{}).favoriteCurrencies||Ie,_=((D=(Z=r==null?void 0:r.users)==null?void 0:Z[n==null?void 0:n.uid])==null?void 0:D.role)==="host";b.useEffect(()=>{S&&U(s=>({...s,...S}))},[S]);const Ne=()=>{const s=`${window.location.origin}/?invite=${f}`;navigator.share?navigator.share({title:"邀請加入 SweetLedger",text:"親愛的，這是我們的專屬記帳連結，點擊加入吧！❤️",url:s}).catch(console.error):(navigator.clipboard.writeText(s),alert("邀請連結已複製！傳送給另一半吧 ❤️"))},Q=()=>{navigator.clipboard.writeText(f),K(!0),setTimeout(()=>K(!1),2e3)},we=(s,i)=>{U(v=>({...v,[s]:i}))},ke=s=>{const i=A[s];i&&!isNaN(parseFloat(i))?h(s,i):U(v=>({...v,[s]:S[s]}))},Ce=async s=>{let i=[...C];const v=!i.includes(s);if(v){if(i.length>=4){alert("最多只能設定 4 個常用貨幣");return}i.push(s)}else if(i.length>1)i=i.filter(I=>I!==s);else{alert("至少保留一個常用貨幣");return}G?(await G("favoriteCurrencies",i),v&&s!=="TWD"&&Te(s).then(I=>{I&&h(s,I)})):console.warn("API 尚未串接：App.jsx 尚未傳入 updateUserSetting")},ze=async()=>{if(window.confirm("警告：此操作將「永久刪除」您的帳號與所有個人資料，且無法復原！")&&window.confirm("再次確認：您確定要刪除帳號嗎？"))try{await he()}catch(s){s.message==="REQ_RELOGIN"?(alert(`為了確保您的帳號安全，執行刪除操作前請先「重新登入」。

系統將為您登出，請登入後再次執行刪除操作。`),await y()):alert("刪除失敗："+s.message)}};return e.jsxs("div",{className:"pb-24 pt-[calc(env(safe-area-inset-top)+2rem)] px-4 animate-in fade-in duration-500",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"設定"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"p-4 flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>l(!0),className:"relative group shrink-0",children:[H((se=(ee=r==null?void 0:r.users)==null?void 0:ee[n.uid])==null?void 0:se.avatar,"w-16 h-16"),e.jsx("div",{className:"absolute bottom-0 right-0 bg-gray-900 text-white p-1.5 rounded-full border-2 border-white shadow-sm",children:e.jsx(ss,{size:10})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("label",{className:"text-[10px] font-bold text-gray-400 uppercase block mb-1",children:"顯示名稱"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"text",value:d,onChange:s=>p(s.target.value),onBlur:L,className:"flex-1 min-w-0 bg-transparent border-b border-gray-200 focus:border-rose-500 outline-none text-gray-900 font-bold py-1 px-0 transition-colors text-lg"})})]})]}),e.jsxs("div",{className:"border-t border-gray-50 p-4 active:bg-gray-50 transition-colors flex justify-between items-center group",children:[e.jsxs("div",{onClick:Q,className:"cursor-pointer flex-1",children:[e.jsx("p",{className:"text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1",children:"帳本代碼"}),e.jsx("p",{className:"text-base font-mono font-medium text-gray-600 tracking-widest group-hover:text-rose-500 transition-colors",children:f})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Ne,className:"p-2 rounded-full text-gray-300 hover:bg-gray-100 hover:text-rose-500 transition-colors",children:e.jsx(ls,{size:18})}),e.jsx("button",{onClick:Q,className:`p-2 rounded-full transition-colors ${X?"bg-green-50 text-green-600":"text-gray-300 hover:bg-gray-100"}`,children:X?e.jsx(W,{size:18}):e.jsx(We,{size:18})})]})]}),e.jsx(xs,{ledgerData:r,user:n,isHost:_,kickMember:ge})]}),e.jsx("section",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:e.jsx(ms,{ledgerData:r,isEditingCategory:o,setIsEditingCategory:c,editingCategoryData:x,setEditingCategoryData:m,handleSaveCategory:j,handleDeleteCategory:N,handleReorderCategories:z})}),e.jsxs("section",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden divide-y divide-gray-50",children:[e.jsxs("div",{className:"p-4 flex justify-between items-center active:bg-gray-50 transition-colors cursor-pointer",onClick:()=>R(!0),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 text-gray-600 rounded-lg",children:e.jsx(re,{size:18})}),e.jsx("span",{className:"font-bold text-gray-700 text-sm",children:"設定常用貨幣"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex -space-x-1",children:[C.slice(0,3).map(s=>e.jsx("span",{className:"text-[10px] bg-gray-100 border border-white px-1.5 py-0.5 rounded-md text-gray-500 font-bold",children:s},s)),C.length>3&&e.jsx("span",{className:"text-[10px] bg-gray-50 border border-white px-1.5 py-0.5 rounded-md text-gray-400 font-bold",children:"..."})]}),e.jsx(k,{size:16,className:"text-gray-300"})]})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center active:bg-gray-50 transition-colors cursor-pointer bg-white",onClick:()=>$(!0),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 text-gray-600 rounded-lg",children:e.jsx(ie,{size:18})}),e.jsx("span",{className:"font-bold text-gray-700 text-sm",children:"專案匯率設定 (TWD)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[10px] text-gray-400 font-bold",children:[C.filter(s=>s!=="TWD"&&A[s]).length," 組設定"]}),e.jsx(k,{size:16,className:"text-gray-300"})]})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center active:bg-gray-50 transition-colors cursor-pointer",onClick:()=>M("subscriptions"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 text-gray-600 rounded-lg",children:e.jsx(Ee,{size:18})}),e.jsx("span",{className:"font-bold text-gray-700 text-sm",children:"固定支出管理"})]}),e.jsx(k,{size:16,className:"text-gray-300"})]}),e.jsx(hs,{ledgerData:r,updatePaymentMethods:pe}),e.jsxs("div",{className:"p-4 flex justify-between items-center active:bg-gray-50 transition-colors cursor-pointer",onClick:w,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 text-gray-600 rounded-lg",children:e.jsx(Ke,{size:18})}),e.jsx("span",{className:"font-bold text-gray-700 text-sm",children:"匯出 CSV"})]}),e.jsx(k,{size:16,className:"text-gray-300"})]}),e.jsx("div",{className:"p-4 flex justify-between items-center active:bg-gray-50 transition-colors cursor-pointer",onClick:y,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 text-gray-500 rounded-lg",children:e.jsx(Je,{size:18})}),e.jsx("span",{className:"font-bold text-gray-500 text-sm",children:"登出帳號 (Logout)"})]})})]}),e.jsxs("section",{className:"space-y-3 pt-2",children:[e.jsxs("h3",{className:"text-xs font-bold text-rose-500 ml-2 flex items-center gap-1",children:[e.jsx(ce,{size:12})," 危險區域"]}),e.jsxs("div",{className:"bg-white rounded-2xl overflow-hidden border border-gray-100 divide-y divide-gray-50",children:[_&&e.jsxs("div",{className:"p-4 flex justify-between items-center active:bg-gray-50 hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>{window.confirm(`確定要升級資料庫嗎？

此操作將遷移資料至高效能儲存結構 (v2)，解決資料上限問題。舊版 App 將無法讀取新資料。`)&&fe()},children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 text-blue-500 rounded-lg",children:e.jsx(Ge,{size:18})}),e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{className:"font-bold text-gray-700 text-sm",children:"升級資料庫 (Performance)"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"遷移至高效能儲存結構 (避免崩潰)"})]})]}),e.jsx(k,{size:16,className:"text-gray-300"})]}),e.jsxs("div",{className:`p-4 flex justify-between items-center transition-colors cursor-pointer ${_?"active:bg-gray-50 hover:bg-gray-50":"opacity-50 grayscale cursor-not-allowed"}`,onClick:me,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 text-gray-500 rounded-lg",children:e.jsx(as,{size:18})}),e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{className:"font-bold text-gray-500 text-sm",children:"重置帳本"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:_?"清空所有資料 (僅戶長)":"僅戶長可執行此操作"})]})]}),_&&e.jsx(k,{size:16,className:"text-gray-300"})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center active:bg-gray-50 hover:bg-gray-50 transition-colors cursor-pointer",onClick:xe,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 text-gray-500 rounded-lg",children:e.jsx(ds,{size:18})}),e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{className:"font-bold text-gray-500 text-sm",children:"退出此帳本"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"移除權限並離開"})]})]}),e.jsx(k,{size:16,className:"text-gray-300"})]}),e.jsxs("div",{className:"p-4 flex justify-between items-center active:bg-gray-50 hover:bg-gray-50 transition-colors cursor-pointer",onClick:ze,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-gray-100 text-gray-500 rounded-lg",children:e.jsx(ce,{size:18})}),e.jsxs("div",{className:"flex flex-col text-left",children:[e.jsx("span",{className:"font-bold text-gray-500 text-sm",children:"刪除帳號"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"永久刪除 User"})]})]}),e.jsx(k,{size:16,className:"text-gray-300"})]})]})]}),e.jsxs("div",{className:"text-center pt-8 pb-8",children:[e.jsx("div",{onClick:()=>{ve(s=>{const i=s+1;return i>=5&&je(!0),i})},className:"inline-block",children:e.jsx("p",{className:"text-[10px] text-gray-300 mt-2 font-mono select-none active:scale-95 transition-transform",children:"SweetLedger v2.0.0 (Pro)"})}),ue&&e.jsxs("button",{onClick:t,className:"mt-4 text-[10px] text-rose-300 hover:text-rose-400 flex items-center gap-1 mx-auto bg-rose-50 px-3 py-1 rounded-full animate-fade-in",children:[e.jsx(is,{size:10})," 修復帳號權限 (Debug)"]})]})]}),ye&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm px-4",onClick:()=>R(!1),children:e.jsxs("div",{className:"bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl animate-scale-up",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(re,{size:18})," 常用貨幣設定"]}),e.jsx("button",{onClick:()=>R(!1),className:"p-1.5 bg-gray-50 rounded-full text-gray-400 hover:bg-gray-100",children:e.jsx(T,{size:18})})]}),e.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"請勾選您最常使用的貨幣（最多 4 個）。這些貨幣將會優先顯示在記帳頁面。"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:le.map(s=>{const i=C.includes(s.code);return e.jsxs("button",{onClick:()=>Ce(s.code),className:`px-3 py-2 rounded-xl text-xs font-bold flex items-center gap-2 transition-all border ${i?"bg-gray-900 text-white border-gray-900 shadow-md":"bg-gray-50 text-gray-500 border-gray-50 hover:bg-gray-100"}`,children:[e.jsx("span",{className:"text-sm",children:s.flag}),s.code,i&&e.jsx(W,{size:12,className:"ml-1"})]},s.code)})}),e.jsx("button",{onClick:()=>R(!1),className:"w-full py-3 font-bold text-white bg-gray-900 rounded-xl shadow-lg shadow-gray-200",children:"完成設定"})]})}),be&&e.jsx("div",{className:"fixed inset-0 z-[70] flex items-center justify-center bg-black/40 backdrop-blur-sm px-4",onClick:()=>$(!1),children:e.jsxs("div",{className:"bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl animate-scale-up",onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-2",children:[e.jsx(ie,{size:18})," 專案匯率設定 (TWD)"]}),e.jsx("button",{onClick:()=>$(!1),className:"p-1.5 bg-gray-50 rounded-full text-gray-400 hover:bg-gray-100",children:e.jsx(T,{size:18})})]}),e.jsx("p",{className:"text-xs text-gray-400 mb-4",children:"設定外幣對 TWD 的固定匯率，以精確計算本專案的真實花費成本。"}),e.jsxs("div",{className:"space-y-3 max-h-[60vh] overflow-y-auto pr-1",children:[C.filter(s=>s!=="TWD").map(s=>{var i;return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl border border-gray-100 focus-within:border-rose-200 focus-within:ring-2 focus-within:ring-rose-50 focus-within:bg-white transition-all shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:(i=le.find(v=>v.code===s))==null?void 0:i.flag}),e.jsx("span",{className:"font-bold text-gray-700",children:s})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"number",value:A[s]!==void 0?A[s]:"",onChange:v=>we(s,v.target.value),onBlur:()=>ke(s),className:"w-24 bg-transparent text-lg font-bold text-gray-900 outline-none text-right",placeholder:"?",step:"0.01"})})]},s)}),C.filter(s=>s!=="TWD").length===0&&e.jsxs("div",{className:"text-center py-6 bg-gray-50 rounded-xl border border-dashed border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-400 font-bold",children:"尚無常用外幣"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"請先至上方「設定常用貨幣」新增"})]})]}),e.jsx("button",{onClick:()=>$(!1),className:"w-full mt-6 py-3 font-bold text-white bg-gray-900 rounded-xl shadow-lg shadow-gray-200 active:scale-95 transition-transform",children:"完成設定"})]})}),a&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/40 backdrop-blur-sm px-4",onClick:()=>l(!1),children:e.jsxs("div",{className:"bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl animate-scale-up",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{className:"text-center font-bold text-lg mb-6 text-gray-800",children:"選擇你的頭像"}),e.jsx("div",{className:"grid grid-cols-3 gap-4 mb-6",children:Object.keys(ne).map(s=>e.jsxs("button",{onClick:()=>O(s),className:`aspect-square rounded-2xl flex flex-col items-center justify-center gap-2 transition-all border-2 
                                ${E===s?"bg-rose-50 border-rose-500 text-rose-500 shadow-md scale-105":"bg-gray-50 border-transparent text-gray-400 hover:bg-gray-100 hover:text-gray-600"}`,children:[H(s,"w-10 h-10 !bg-transparent !text-current !rounded-none !border-0"),e.jsx("span",{className:"text-[10px] font-bold",children:ne[s].name})]},s))}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>l(!1),className:"flex-1 py-3 font-bold text-gray-500 bg-gray-100 rounded-xl",children:"取消"}),e.jsx("button",{onClick:P,className:"flex-1 py-3 font-bold text-white bg-gray-900 rounded-xl shadow-lg shadow-gray-200",children:"確認"})]})]})})]})}export{vs as default};
