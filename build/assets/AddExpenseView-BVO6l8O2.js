import{c as O,r as a,j as e,f as it,T as ct,P as dt,h as $e,U as oe,i as Ae,g as Re,d as Te,p as xt,k as ut,D as Ie,l as mt,I as gt,e as Q,X as re,L as ze,R as le,S as ft,C as Z,m as ht,n as pt,o as bt,q as yt,s as jt,t as vt}from"./index-C4uV2iwB.js";import{C as Nt}from"./circle-alert-C3qrMgbL.js";import{R as wt}from"./repeat-DJ6FPCct.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],St=O("camera",Ct);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]],It=O("circle-stop",kt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zt=[["path",{d:"M20 4v7a4 4 0 0 1-4 4H4",key:"6o5b7l"}],["path",{d:"m9 10-5 5 5 5",key:"1kshq7"}]],_t=O("corner-down-left",zt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=[["path",{d:"M10 5a2 2 0 0 0-1.344.519l-6.328 5.74a1 1 0 0 0 0 1.481l6.328 5.741A2 2 0 0 0 10 19h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2z",key:"1yo7s0"}],["path",{d:"m12 9 6 6",key:"anjzzh"}],["path",{d:"m18 9-6 6",key:"1fp51s"}]],_e=O("delete",$t);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=[["line",{x1:"5",x2:"19",y1:"9",y2:"9",key:"1nwqeh"}],["line",{x1:"5",x2:"19",y1:"15",y2:"15",key:"g8yjpy"}]],Rt=O("equal",At);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Et=O("image",Tt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],Ft=O("mic",Ot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Lt=O("tag",Mt);function Dt({isOpen:u,onClose:i,onConfirm:f,initialItems:o=[],currency:b="TWD",users:y={}}){if(!u)return null;const[c,n]=a.useState([]),[h,m]=a.useState(null),[w,C]=a.useState(null);a.useEffect(()=>{const s=o.map((d,N)=>({id:Date.now()+N,name:d.name||"未命名品項",price:parseFloat(d.price)||0,quantity:d.quantity||1,owner:"shared"}));n(s);const l=Object.keys(y).find(d=>y[d].role==="host"),g=Object.keys(y).find(d=>y[d].role==="guest");m(l),C(g)},[o,y]);const D=s=>{n(l=>l.map(g=>{if(g.id!==s)return g;let d="shared";return g.owner==="shared"?d="host":g.owner==="host"?d="guest":d="shared",{...g,owner:d}}))},j=(s,l,g)=>{n(d=>d.map(N=>N.id!==s?N:{...N,[l]:g}))},F=s=>{n(l=>l.filter(g=>g.id!==s))},k=()=>{n(s=>[...s,{id:Date.now(),name:"新項目",price:0,quantity:1,owner:"shared"}])},_=()=>{let s=0,l=0,g=0;const d=[];c.forEach(R=>{const $=parseFloat(R.price);$&&(s+=$,d.push(R.name),R.owner==="host"?l+=$:R.owner==="guest"?g+=$:(l+=$/2,g+=$/2))});const N={amount:s,note:d.join(", "),splitType:"custom",customSplit:{}};h&&(N.customSplit[h]=l),w&&(N.customSplit[w]=g),f(N),i()},I=s=>{switch(s){case"host":return"bg-blue-50 border-blue-200 text-blue-700";case"guest":return"bg-pink-50 border-pink-200 text-pink-700";default:return"bg-white border-gray-100 text-gray-700"}},P=s=>s==="host"?e.jsx(oe,{size:16,className:"text-blue-500 fill-blue-100"}):s==="guest"?e.jsx(oe,{size:16,className:"text-pink-500 fill-pink-100"}):e.jsx(Ae,{size:16,className:"text-gray-400"}),z=s=>{var l,g;return s==="host"?((l=y[h])==null?void 0:l.name)||"Host":s==="guest"?((g=y[w])==null?void 0:g.name)||"Guest":"平分"},v=c.reduce((s,l)=>s+(parseFloat(l.price)||0),0);return e.jsxs("div",{className:"fixed inset-0 z-[100] bg-gray-50 flex flex-col animate-in slide-in-from-bottom duration-300",children:[e.jsxs("div",{className:"bg-white px-4 py-3 border-b border-gray-100 flex justify-between items-center pt-[calc(env(safe-area-inset-top)+0.5rem)] shadow-sm shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-bold text-lg text-gray-800",children:"分帳掃描器"}),e.jsx("p",{className:"text-xs text-gray-400",children:"點擊項目切換歸屬"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xl font-bold text-gray-900",children:it(v,b)}),e.jsx("div",{className:"text-[10px] text-gray-400 font-medium",children:"總金額"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 pb-32",children:[c.map(s=>e.jsxs("div",{onClick:()=>D(s.id),className:`relative rounded-2xl border-2 p-3 transition-all active:scale-[0.98] duration-200 flex items-center justify-between shadow-sm ${I(s.owner)}`,children:[e.jsxs("div",{className:"flex-1 min-w-0 mr-4",onClick:l=>l.stopPropagation(),children:[e.jsx("input",{type:"text",value:s.name,onChange:l=>j(s.id,"name",l.target.value),className:"w-full bg-transparent font-bold text-sm mb-1 outline-none placeholder-gray-300",placeholder:"品項名稱"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-xs opacity-50",children:"$"}),e.jsx("input",{type:"number",value:s.price,onChange:l=>j(s.id,"price",l.target.value),className:"w-20 bg-transparent font-bold text-lg outline-none placeholder-gray-300",placeholder:"0"})]})]}),e.jsx("div",{className:"flex flex-col items-end gap-1 pointer-events-none",children:e.jsxs("div",{className:"flex items-center gap-1.5 bg-white/50 px-2 py-1 rounded-lg backdrop-blur-sm",children:[P(s.owner),e.jsx("span",{className:"text-xs font-bold",children:z(s.owner)})]})}),e.jsx("button",{onClick:l=>{l.stopPropagation(),F(s.id)},className:"absolute -top-2 -right-2 w-6 h-6 bg-red-100 text-red-500 rounded-full flex items-center justify-center shadow-sm opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ct,{size:12})})]},s.id)),e.jsxs("button",{onClick:k,className:"w-full py-4 rounded-2xl border-2 border-dashed border-gray-200 text-gray-400 font-bold flex items-center justify-center gap-2 hover:bg-gray-100 hover:border-gray-300 transition-all active:scale-95",children:[e.jsx(dt,{size:20}),"手動新增項目"]})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white border-t border-gray-100 p-4 pb-[calc(env(safe-area-inset-bottom)+1rem)] flex gap-3 shadow-[0_-4px_20px_rgba(0,0,0,0.05)]",children:[e.jsx("button",{onClick:i,className:"px-6 py-4 rounded-xl bg-gray-100 text-gray-500 font-bold active:scale-95 transition-transform",children:"取消"}),e.jsxs("button",{onClick:_,className:"flex-1 py-4 rounded-xl bg-gray-900 text-white font-bold text-lg flex items-center justify-center gap-2 shadow-lg shadow-gray-200 active:scale-95 transition-transform",children:[e.jsx($e,{size:20}),"確認分帳"]})]})]})}const Pt=a.memo(function({onKeyPress:i,isMathPending:f}){const o=(b,y="num",c="")=>{let n=b;return b==="DEL"?n=e.jsx(_e,{size:22}):b==="DONE"&&(n=f?e.jsx(Rt,{size:28}):e.jsx(_t,{size:28,strokeWidth:3})),e.jsx("button",{onClick:h=>{h.stopPropagation(),i(b)},className:`
                rounded-2xl text-xl font-bold flex items-center justify-center select-none 
                active:scale-95 transition-transform 
                ${c} 
                ${y==="num"?"bg-white text-slate-700 shadow-[0_2px_0_#e2e8f0]":""} 
                ${y==="op"?"bg-rose-50 text-rose-500":""} 
                ${y==="action"?"bg-rose-500 text-white shadow-lg shadow-rose-200":""} 
            `,style:{height:"56px"},children:n})};return e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-gray-50 rounded-t-3xl z-50 animate-slide-up shadow-[0_-10px_40px_rgba(0,0,0,0.1)] pb-[env(safe-area-inset-bottom)]",children:[e.jsx("div",{className:"flex justify-center pt-2 pb-1",children:e.jsx("div",{className:"w-10 h-1 bg-gray-300 rounded-full"})}),e.jsxs("div",{className:"grid grid-cols-4 gap-3 p-4",children:[o("7")," ",o("8")," ",o("9")," ",o("+","op"),o("4")," ",o("5")," ",o("6")," ",o("-","op"),o("1")," ",o("2")," ",o("3")," ",o("×","op"),o("0")," ",o(".")," ",o("DONE","action","col-span-1")," ",o("÷","op")]}),e.jsx("div",{className:"px-4 pb-2 flex justify-end",children:e.jsxs("button",{onClick:()=>i("DEL"),className:"flex items-center gap-2 text-gray-400 font-bold px-4 py-2 rounded-lg active:bg-gray-200 transition-colors",children:[e.jsx(_e,{size:18})," 刪除"]})})]})}),Ut=a.memo(function({categories:i,selectedCategory:f,onSelect:o}){return e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl z-50 animate-slide-up shadow-[0_-10px_40px_rgba(0,0,0,0.1)] flex flex-col max-h-[70vh]",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-4 shrink-0",children:e.jsx("div",{className:"w-10 h-1 bg-gray-200 rounded-full"})}),e.jsx("div",{className:"px-6 mb-2 shrink-0",children:e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"選擇分類"})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 pt-0",children:e.jsx("div",{className:"grid grid-cols-4 gap-4 pb-[env(safe-area-inset-bottom)]",children:i.map(b=>{const y=Re(b.icon),c=(f==null?void 0:f.id)===b.id,n=Te(b,"input");return e.jsxs("button",{onClick:()=>o(b),className:"flex flex-col items-center gap-2 group p-1",children:[e.jsx("div",{className:`
                                w-14 h-14 rounded-3xl flex items-center justify-center transition-all shrink-0 border
                                ${c?n.activeClass:n.containerClass}
                                ${c?"scale-110 shadow-lg":"group-active:scale-95"}
                            `,children:e.jsx(y,{size:24,className:c?"text-white":n.iconClass})}),e.jsx("span",{className:`text-xs font-bold ${c?"text-gray-900":"text-gray-400"}`,children:b.name})]},b.id)})})})]})});function Wt({tags:u,onSelect:i}){return!u||u.length===0?null:e.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar mt-3 pb-1",children:u.map((f,o)=>e.jsxs("button",{onClick:()=>i(f),className:`
                    flex items-center gap-1 px-3 py-1.5 bg-gray-50 text-gray-500 text-xs rounded-xl border border-gray-100 
                    active:scale-95 transition-transform whitespace-nowrap font-medium 
                    hover:bg-rose-50 hover:text-rose-500 hover:border-rose-100
                `,children:[e.jsx(Lt,{size:10})," ",f]},o))})}function qt(u){const[i,f]=a.useState(""),o=/[+\-×÷]/.test(i)&&!/[+\-×÷]$/.test(i),b=()=>{if(o){try{const c=i.replace(/×/g,"*").replace(/÷/g,"/"),n=new Function("return "+c)();let h=Math.round(n*100)/100;h>1e8&&(h=1e8),f(h.toString())}catch(c){console.error("Calculation error",c)}return}if(!(!i||parseFloat(i)<=0)){if(parseFloat(i)>1e8){f("100000000");return}u&&u()}},y=a.useCallback(c=>{if(navigator.vibrate)try{navigator.vibrate(10)}catch{}const n=["+","-","×","÷"];if(c==="AC"){f("");return}if(c==="DEL"){f(m=>m.slice(0,-1));return}if(c==="DONE"){b();return}const h=1e8;if(c==="."){f(m=>{const w=m.slice(-1);return!m||n.includes(w)?m+"0.":m.includes(".")&&!n.some(C=>m.lastIndexOf(C)>m.lastIndexOf("."))?m:m+c});return}f(m=>{const w=m.slice(-1);if(n.includes(c)){if(n.includes(w))return m.slice(0,-1)+c;if(!m)return m}const C=m+c;return!/[+\-×÷]/.test(C)&&parseFloat(C)>h?m:m+c})},[i,o]);return{localAmount:i,setLocalAmount:f,handleKeyPress:y,isMathPending:o,handleKeypadSubmit:b}}function Ht({setLocalAmount:u,setNote:i,setSplitType:f,setCustomSplitHost:o,setCustomSplitGuest:b,setActiveOverlay:y,hostId:c,guestId:n}){const[h,m]=a.useState(!1),[w,C]=a.useState(!1),[D,j]=a.useState([]),F=a.useRef(null),k=a.useRef(null);return{isScanning:h,isScanModalOpen:w,setIsScanModalOpen:C,scannedItems:D,cameraInputRef:F,fileInputRef:k,handleImageUpload:async v=>{var g;const s=(g=v.target.files)==null?void 0:g[0];if(!s)return;v.target.value="",m(!0);const l=new FileReader;l.onloadend=async()=>{try{const d=l.result.split(",")[1],N=await xt(d);m(!1),N&&Array.isArray(N)?(j(N),C(!0)):alert("掃描失敗，請再試一次或手動輸入")}catch(d){console.error("Scanning Error",d),m(!1),alert("掃描發生錯誤："+d.message)}},l.readAsDataURL(s)},handleCameraClick:()=>{var v;(v=F.current)==null||v.click()},handleAlbumClick:()=>{var v;(v=k.current)==null||v.click()},handleScanConfirm:v=>{const{amount:s,note:l,splitType:g,customSplit:d}=v;u&&u(s.toString()),i&&l&&i(l),f&&f(g),d&&(c&&d[c]&&o&&o(d[c].toString()),n&&d[n]&&b&&b(d[n].toString())),s>0&&y&&y("category")}}}function Bt({ledgerData:u,user:i,currentProjectId:f,setView:o,addTransaction:b,isSubmittingTransaction:y,updateProjectRates:c}){var je,ve,Ne,we,Ce,Se,ke;if(!u)return null;const n=(je=u.projects)==null?void 0:je.find(t=>t.id===f),h=(n==null?void 0:n.type)==="private",[m,w]=a.useState(""),[C,D]=a.useState(ut()),[j,F]=a.useState(Ie[0]),[k,_]=a.useState("amount"),[I,P]=a.useState(()=>n!=null&&n.defaultCurrency?n.defaultCurrency:localStorage.getItem("sweet_last_currency")||"TWD"),[z,v]=a.useState("even"),[s,l]=a.useState(""),[g,d]=a.useState(""),[N,R]=a.useState(""),[$,ee]=a.useState(""),[L,Ee]=a.useState(!1),[ie,Oe]=a.useState("monthly"),[ce,Fe]=a.useState(""),[Me,te]=a.useState(!1),[U,se]=a.useState(""),[de,xe]=a.useState(!1),[ae,ne]=a.useState(!1),[Le,ue]=a.useState(!1),[De,G]=a.useState(!1),[W,me]=a.useState(""),V=a.useRef(null),ge=a.useRef(null),K=a.useMemo(()=>u.customCategories||Ie,[u.customCategories]),Pe=(((ve=u.users)==null?void 0:ve[i==null?void 0:i.uid])||{}).favoriteCurrencies||mt,Ue=a.useMemo(()=>{var x;const t=((x=u.settings)==null?void 0:x.selectedCategories)||gt.settings.selectedCategories;return K.filter(r=>t.includes(r.id))},[K,(Ne=u.settings)==null?void 0:Ne.selectedCategories]),A=u.users||{},q=Object.keys(A).find(t=>A[t].role==="host"),M=Object.keys(A).find(t=>A[t].role==="guest"),J=q&&((we=A[q])==null?void 0:we.name)||"戶長",B=M&&((Ce=A[M])==null?void 0:Ce.name)||"成員",fe=((Se=A[s])==null?void 0:Se.role)==="host",{localAmount:T,setLocalAmount:he,handleKeyPress:We,isMathPending:qe}=qt(()=>_("category")),{isScanning:H,isScanModalOpen:He,setIsScanModalOpen:Ge,scannedItems:Ve,cameraInputRef:Ke,fileInputRef:Je,handleImageUpload:pe,handleCameraClick:Be,handleAlbumClick:Xe,handleScanConfirm:Ye}=Ht({setLocalAmount:he,setNote:w,setSplitType:v,setCustomSplitHost:R,setCustomSplitGuest:ee,setActiveOverlay:_,hostId:q,guestId:M}),Qe=a.useMemo(()=>{if(!u.transactions||!j)return[];const x=u.transactions.slice(-50).reverse().filter(r=>r.category.id===j.id&&r.note).map(r=>r.note);return[...new Set(x)].slice(0,5)},[u.transactions,j]);a.useEffect(()=>{localStorage.setItem("sweet_last_currency",I)},[I]),a.useEffect(()=>{!s&&i&&l(i.uid)},[i,s]),a.useEffect(()=>{h?(v("self"),i&&l(i.uid)):z==="self"&&v("even")},[h,i]);const Ze=t=>{F(t),_("none"),setTimeout(()=>{var x;(x=V.current)==null||x.focus()},100)},et=async()=>{if(!U)return;te(!1),xe(!0);let t=`你是一個記帳助手。請分析使用者的輸入，並回傳一個 JSON 物件。
目前的日期是：${new Date().toLocaleString("zh-TW")}。
        可用的分類 ID: ${K.map(r=>r.id).join(", ")}
請解析：1. 金額(amount) 2. 類別 ID(categoryId) 3. 備註(note) 4. 幣別(currency, 預設 TWD)
        只回傳 JSON。`;h&&(t+=`
[重要指令] 此為「私人帳本」模式。請將所有交易視為使用者個人支出，不需要考慮分帳、代墊或AA制邏輯。`),U&&(t+=`
使用者文字: "${U}"`);const x=await jt(t,null);if(xe(!1),se(""),!x){alert("AI 無法解析");return}try{const r=x.replace(/```json/g,"").replace(/```/g,"").trim(),p=JSON.parse(r);if(p.amount&&he(p.amount.toString()),p.note&&w(p.note),p.currency&&P(p.currency),p.categoryId){const S=K.find(E=>E.id===p.categoryId);S&&F(S)}}catch(r){console.error("AI Parse Error",r),alert("AI 解析失敗")}},tt=()=>{var t;if(ae)(t=ge.current)==null||t.stop(),ne(!1);else{if(!window.webkitSpeechRecognition&&!window.SpeechRecognition){alert("您的瀏覽器不支援語音辨識");return}const x=window.SpeechRecognition||window.webkitSpeechRecognition,r=new x;r.lang="zh-TW",r.continuous=!0,r.interimResults=!0,r.onresult=p=>{let S="";for(let E=p.resultIndex;E<p.results.length;++E)p.results[E].isFinal&&(S+=p.results[E][0].transcript);S&&se(E=>E+S)},r.onerror=p=>{console.error("Speech error",p.error),ne(!1)},ge.current=r,r.start(),ne(!0)}},st=async()=>{if(!T||parseFloat(T)<=0)return;const t=parseFloat(T);let x=null;if(z==="custom"||z==="multi_payer"){const r=parseFloat(N)||0,p=parseFloat($)||0;if(Math.abs(r+p-t)>.1){alert(`雙方金額總和 (${r+p}) 必須等於支出總額 (${t})！`);return}x={},q&&(x[q]=r),M&&(x[M]=p)}o("dashboard");try{await b({amount:t,currency:I,category:j,payer:s||i.uid,splitType:z,customSplit:x,note:m||j.name,projectId:f,date:C,isSubscription:L,subCycle:ie,subPayDay:ce,paymentMethod:g})}catch(r){console.error("Add Tx Error:",r)}},at=()=>{var t;_("amount"),(t=V.current)==null||t.blur()},nt=()=>{var t;_("category"),(t=V.current)==null||t.blur()},X=()=>{_("none")},be=(t,x)=>{const r=parseFloat(T)||0,p=parseFloat(x)||0;if(t==="host"){R(x);const S=r-p;ee(S>=0?S.toString():"0")}else{ee(x);const S=r-p;R(S>=0?S.toString():"0")}},rt=Te(j,"input"),lt=Re((j==null?void 0:j.icon)||"food"),Y=t=>{var r;const x=(r=A[s])==null?void 0:r.role;return t==="host"?x==="host"?`私人 (${J})`:x==="guest"?`代墊 (幫${J}付)`:`${J} 全額`:x==="guest"?`私人 (${B})`:x==="host"?`代墊 (幫${B}付)`:`${B} 全額`},ot=W?Q.filter(t=>t.code.includes(W.toUpperCase())||t.name.includes(W)):Q,ye=async t=>{if(P(t),G(!1),me(""),t==="TWD")return;if(!((n==null?void 0:n.rates)||{})[t]){ue(!0);const r=await vt(t);r&&c&&await c(f,t,r),ue(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-[50] flex flex-col h-[100dvh] bg-gray-50 overflow-hidden",children:[e.jsx("input",{type:"file",ref:Ke,accept:"image/*",capture:"environment",className:"hidden",onChange:pe}),e.jsx("input",{type:"file",ref:Je,accept:"image/*",className:"hidden",onChange:pe}),e.jsx(Dt,{isOpen:He,onClose:()=>Ge(!1),onConfirm:Ye,initialItems:Ve,currency:I,users:A}),e.jsxs("div",{className:"bg-white px-4 pb-3 pt-[calc(env(safe-area-inset-top)+0.5rem)] z-20 shrink-0 shadow-sm border-b border-gray-100 relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("button",{onClick:()=>o("dashboard"),className:"p-2 -ml-2 text-slate-400 hover:bg-slate-100 rounded-full transition-colors",children:e.jsx(re,{size:24})}),e.jsxs("div",{className:`font-bold text-sm px-3 py-1 rounded-full border flex items-center gap-2 ${h?"bg-gray-800 text-white border-gray-700":"text-slate-700 bg-gray-100 border-gray-200"}`,children:[h&&e.jsx(ze,{size:12}),(n==null?void 0:n.name)||"日常"]}),e.jsxs("div",{className:"flex gap-2 -mr-1",children:[e.jsx("button",{onClick:Xe,disabled:H,className:`w-9 h-9 rounded-full flex items-center justify-center transition-all ${H?"opacity-30":"bg-gray-100 text-gray-500 hover:bg-gray-200 active:scale-95"}`,children:e.jsx(Et,{size:18,strokeWidth:2.5})}),e.jsx("button",{onClick:Be,disabled:H,className:`w-9 h-9 rounded-full flex items-center justify-center transition-all ${H?"bg-blue-100 text-blue-600 animate-pulse":"bg-gray-100 text-gray-500 hover:bg-blue-50 hover:text-blue-500 active:scale-95"}`,children:H?e.jsx(le,{className:"animate-spin",size:18}):e.jsx(St,{size:18,strokeWidth:2.5})}),e.jsxs("button",{onClick:()=>te(!0),className:`h-9 px-3 rounded-full flex items-center justify-center gap-1.5 transition-all ${de?"bg-purple-100 text-purple-600":"bg-purple-50 text-purple-600 hover:bg-purple-100 active:scale-95"}`,children:[de?e.jsx(le,{className:"animate-spin",size:16}):e.jsx(ft,{size:16,strokeWidth:2.5}),e.jsx("span",{className:"text-xs font-bold whitespace-nowrap",children:"AI 記帳"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>G(!0),className:"flex items-center gap-1.5 bg-gray-100 rounded-lg px-3 py-1.5 border border-gray-200 active:bg-gray-200 transition-colors",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800",children:I}),Le?e.jsx(le,{className:"animate-spin w-3 h-3 text-rose-500 ml-1"}):e.jsx(Z,{size:14,className:"text-gray-400"})]}),e.jsxs("div",{className:"flex-1 bg-gray-100 border border-gray-200 rounded-lg flex items-center px-3 py-1.5 text-slate-600 relative",children:[e.jsx(ht,{size:14,className:"mr-2 opacity-50"}),e.jsx("input",{type:"date",value:C,onChange:t=>D(t.target.value),className:"bg-transparent text-xs font-bold w-full outline-none z-10 text-gray-700"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto overscroll-contain pb-32",children:[e.jsxs("div",{className:"px-4 py-6 bg-white mb-3 shadow-sm border-b border-gray-100",children:[e.jsx("div",{className:"flex justify-center mb-6 overflow-x-auto no-scrollbar",children:e.jsxs("button",{onClick:at,className:`text-5xl font-bold tracking-tight flex items-center transition-all px-4 mx-auto ${T?"text-gray-900":"text-gray-300"} ${k==="amount"?"scale-105":""}`,children:[e.jsx("span",{className:"text-2xl mr-2 text-gray-300 font-medium whitespace-nowrap",children:((ke=Q.find(t=>t.code===I))==null?void 0:ke.symbol)||"$"}),e.jsx("span",{className:"whitespace-nowrap",children:T||"0"}),k==="amount"&&e.jsx("div",{className:"w-[3px] h-10 bg-rose-500 animate-cursor-blink ml-1 rounded-full shrink-0"})]})}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs("button",{onClick:nt,className:`flex-none w-[35%] flex items-center gap-2 p-3 rounded-2xl border transition-all ${k==="category"?"bg-rose-50 border-rose-200 ring-2 ring-rose-100":"bg-gray-50 border-gray-100"}`,children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center shadow-sm shrink-0 transition-colors ${j?rt.activeClass:"bg-white text-rose-500"}`,children:e.jsx(lt,{size:18})}),e.jsxs("div",{className:"flex-1 min-w-0 text-left",children:[e.jsx("div",{className:"text-[10px] text-gray-400",children:"分類"}),e.jsx("div",{className:"font-bold text-gray-700 text-sm truncate",children:j==null?void 0:j.name})]}),e.jsx(Z,{size:14,className:"text-gray-400 shrink-0"})]}),e.jsx("div",{className:"flex-1 bg-gray-50 rounded-2xl border border-gray-100 flex items-center px-4 focus-within:border-rose-200 focus-within:ring-2 focus-within:ring-rose-50 transition-all",children:e.jsx("input",{ref:V,type:"text",value:m,onChange:t=>w(t.target.value),maxLength:50,onFocus:X,placeholder:"寫點備註...",className:"w-full bg-transparent outline-none text-sm text-gray-700 placeholder-gray-400 font-medium"})})]}),e.jsx(Wt,{tags:Qe,onSelect:w})]}),e.jsx("div",{className:"px-4",children:e.jsxs("div",{className:"bg-white rounded-3xl p-5 shadow-sm border border-gray-100 space-y-5",children:[h?e.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3 text-gray-500",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center text-gray-500",children:e.jsx(ze,{size:16})}),e.jsx("span",{className:"text-sm font-bold",children:"私人記帳模式"})]}),e.jsx("span",{className:"text-xs font-bold text-gray-400 bg-white px-2 py-1 rounded border border-gray-100",children:"不進行分攤"})]}):e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-500",children:e.jsx(Ae,{size:16})}),e.jsx("span",{className:"text-sm font-bold",children:"分攤模式"})]}),e.jsxs("div",{className:"relative w-40",children:[e.jsxs("select",{value:z,onChange:t=>v(t.target.value),className:"w-full appearance-none bg-gray-50 text-xs font-bold text-gray-700 py-2 pl-3 pr-8 rounded-xl outline-none border border-gray-100 focus:border-blue-200 text-right",children:[e.jsx("option",{value:"even",children:"平均分攤"}),e.jsx("option",{value:"multi_payer",children:"混合出資"}),e.jsx("option",{value:"self",children:Y(fe?"host":"guest")}),e.jsx("option",{value:"partner",children:Y(fe?"guest":"host")})]}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400",children:e.jsx(Z,{size:14})})]})]}),z==="multi_payer"&&!h&&e.jsxs("div",{className:"bg-rose-50 p-3 rounded-xl border border-rose-100 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1 mb-2",children:[e.jsx(Nt,{size:12,className:"text-rose-500"}),e.jsx("p",{className:"text-[10px] text-rose-500 font-bold text-center",children:"輸入雙方「當下實際支付」的金額"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-xs font-bold text-gray-400 max-w-[4rem] truncate",children:J}),e.jsx("input",{type:"number",value:N,onChange:t=>be("host",t.target.value),onFocus:X,className:"w-full py-2 pl-16 pr-2 bg-white rounded-lg text-sm text-right font-bold outline-none border border-gray-200 focus:border-blue-300"})]}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-xs font-bold text-gray-400 max-w-[4rem] truncate",children:B}),e.jsx("input",{type:"number",value:$,onChange:t=>be("guest",t.target.value),onFocus:X,disabled:!M,placeholder:M?"":"N/A",className:"w-full py-2 pl-16 pr-2 bg-white rounded-lg text-sm text-right font-bold outline-none border border-gray-200 focus:border-blue-300 disabled:bg-gray-100"})]})]})]}),z!=="multi_payer"&&!h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-[1px] bg-gray-50 w-full"}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 flex-1 min-w-0",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-500 shrink-0",children:e.jsx(oe,{size:16})}),e.jsx("span",{className:"text-sm font-bold shrink-0",children:"付款人"}),e.jsx("div",{className:"flex gap-2 overflow-x-auto no-scrollbar py-1 ml-auto",children:Object.keys(u.users||{}).map(t=>e.jsx("button",{onClick:()=>l(t),className:`px-3 py-1.5 rounded-full text-xs font-bold whitespace-nowrap transition-all border ${s===t?"bg-gray-900 text-white border-gray-900 shadow-sm":"bg-white text-gray-400 border-gray-200"}`,children:u.users[t].name},t))})]})})]}),z!=="multi_payer"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-[1px] bg-gray-50 w-full"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-500",children:e.jsx(pt,{size:16})}),e.jsx("span",{className:"text-sm font-bold",children:"支付方式"})]}),e.jsxs("div",{className:"relative w-40",children:[e.jsxs("select",{value:g,onChange:t=>d(t.target.value),className:`w-full appearance-none bg-gray-50 text-xs font-bold py-2 pl-3 pr-8 rounded-xl outline-none border border-gray-100 focus:border-blue-200 text-right ${g?"text-gray-700":"text-gray-400"}`,children:[e.jsx("option",{value:"",children:"未指定"}),(u.paymentMethods||[]).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400",children:e.jsx(Z,{size:14})})]})]})]}),e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>Ee(!L),className:`w-full flex items-center justify-between p-3 rounded-xl border transition-all ${L?"bg-rose-50 border-rose-200":"bg-white border-gray-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center text-slate-500 shrink-0",children:e.jsx(wt,{size:16})}),e.jsx("span",{className:`text-sm font-bold ${L?"text-rose-600":"text-gray-500"}`,children:"設為固定支出 (訂閱/分期)"})]}),e.jsx("div",{className:`w-4 h-4 rounded-full border ${L?"bg-rose-500 border-rose-500":"bg-transparent border-gray-300"}`})]}),L&&e.jsxs("div",{className:"flex items-center gap-2 mt-3 pl-2 animate-fade-in justify-end",children:[e.jsx("span",{className:"text-xs text-gray-400 font-bold",children:"每"}),e.jsxs("select",{value:ie,onChange:t=>Oe(t.target.value),className:"bg-gray-100 text-gray-700 text-xs py-1 px-2 rounded-lg outline-none font-bold",children:[e.jsx("option",{value:"monthly",children:"月"}),e.jsx("option",{value:"weekly",children:"週"})]}),e.jsx("input",{type:"number",placeholder:"日",value:ce,onChange:t=>Fe(t.target.value),onFocus:X,className:"w-12 bg-gray-100 text-gray-700 p-1 rounded-lg text-xs text-center font-bold outline-none"}),e.jsx("span",{className:"text-xs text-gray-400 font-bold",children:"號扣款"})]})]})]})})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-100 pb-[calc(env(safe-area-inset-bottom)+1rem)] z-30",children:e.jsxs("button",{onClick:st,disabled:!T||parseFloat(T)<=0,className:"w-full bg-gray-900 text-white text-lg font-bold py-4 rounded-2xl shadow-lg shadow-gray-200 active:scale-95 transition-transform flex items-center justify-center gap-2 disabled:opacity-50 disabled:shadow-none",children:[e.jsx($e,{size:24}),k==="category"?"完成記帳":"下一步"]})}),k==="amount"&&e.jsx(Pt,{onKeyPress:We,isMathPending:qe}),k==="category"&&e.jsx(Ut,{categories:Ue,selectedCategory:j,onSelect:Ze}),Me&&e.jsxs("div",{className:"absolute inset-0 z-[60] bg-white/95 backdrop-blur-sm flex flex-col px-6 pb-6 pt-[calc(env(safe-area-inset-top)+3rem)] animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"AI 智慧輸入"}),e.jsx("button",{onClick:()=>{te(!1)},className:"p-2 bg-gray-100 rounded-full",children:e.jsx(re,{size:20})})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[e.jsx("textarea",{value:U,onChange:t=>se(t.target.value),placeholder:"例如：午餐吃拉麵 250元...",className:"w-full h-40 p-4 bg-gray-50 rounded-2xl text-lg outline-none resize-none border border-gray-200 focus:border-purple-500 transition-colors"}),e.jsx("div",{className:"flex justify-center gap-4 mt-auto mb-8",children:e.jsx("button",{onClick:tt,className:`p-6 rounded-full transition-all ${ae?"bg-red-50 text-red-500 scale-110 shadow-red-200":"bg-purple-50 text-purple-600 shadow-purple-200"} shadow-lg`,children:ae?e.jsx(It,{size:32}):e.jsx(Ft,{size:32})})}),e.jsx("button",{onClick:et,disabled:!U,className:"w-full bg-gray-900 text-white py-4 rounded-xl font-bold text-lg mb-4",children:"開始分析"})]})]}),De&&e.jsxs("div",{className:"absolute inset-0 z-[70] flex flex-col justify-end",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity",onClick:()=>G(!1)}),e.jsxs("div",{className:"bg-white rounded-t-3xl p-6 relative z-10 max-h-[80vh] flex flex-col animate-slide-up",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-800",children:"選擇幣別"}),e.jsx("button",{onClick:()=>G(!1),className:"p-2 bg-gray-50 rounded-full",children:e.jsx(re,{size:20})})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(bt,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"搜尋貨幣 (例如: USD)",value:W,onChange:t=>me(t.target.value),className:"w-full bg-gray-50 pl-10 pr-4 py-3 rounded-xl font-bold text-sm outline-none border border-transparent focus:bg-white focus:border-rose-200 transition-all"})]}),e.jsxs("div",{className:"overflow-y-auto space-y-6",children:[!W&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase mb-2",children:"常用貨幣"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["TWD",...Pe.filter(t=>t!=="TWD")].map(t=>{const x=Q.find(r=>r.code===t);return x?e.jsxs("button",{onClick:()=>ye(t),className:`flex flex-col items-center justify-center gap-1 p-4 rounded-2xl border transition-all ${I===t?"bg-rose-50 border-rose-500 text-rose-600 ring-1 ring-rose-500":"bg-white border-gray-100 hover:border-gray-300"}`,children:[e.jsx("span",{className:"text-2xl",children:x.flag}),e.jsx("span",{className:"font-bold text-sm",children:t})]},t):null})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-bold text-gray-400 uppercase mb-2",children:"所有貨幣"}),e.jsx("div",{className:"space-y-2",children:ot.map(t=>e.jsxs("button",{onClick:()=>ye(t.code),className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-xl transition-colors text-left group",children:[e.jsx("span",{className:"text-2xl w-8 text-center",children:t.flag}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-bold text-gray-800",children:t.code}),e.jsx("div",{className:"text-xs text-gray-400",children:t.name})]}),I===t.code&&e.jsx(yt,{size:18,className:"text-rose-500"})]},t.code))})]})]})]})]})]})}export{Bt as default};
