import{c as A,r as G,D as ne,a as T,j as e,C as ie,L as oe,W as ce,f as u,b as V,g as de,d as me,e as pe}from"./index-DyGYZdUV.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],ye=A("arrow-right-left",he);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],ue=A("eye-off",xe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],fe=A("eye",ge);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],Y=A("history",be);function we({ledgerData:y,currentProjectId:S,setCurrentProjectId:B,privacyMode:c,setPrivacyMode:J,setIsEditTxModalOpen:K,setEditingTx:Q,user:d,handleSettleUp:X,handleOpenAddExpense:je,setView:M}){var P;if(!y||!d)return null;const Z=(y.projects||[]).filter(s=>s.type!=="private"||s.owner===d.uid),k=((P=y.projects)==null?void 0:P.find(s=>s.id===S))||{name:"æ—¥å¸¸",type:"public"},N=k.type==="private",{allTxs:E,safeUsers:g}=G.useMemo(()=>{const s=y.transactions||[],a=y.users||{},l=y.customCategories||ne;return{allTxs:s.filter(n=>n&&n.id&&n.amount!==void 0).map(n=>{var p;const i=["income","expense"].includes(n.type)?n.type:"expense";let m=n.category||{name:"æœªåˆ†é¡",icon:"help-circle"};if((p=n.category)!=null&&p.id){const b=l.find(j=>j.id===n.category.id);b&&(m=b)}const o=n.date||new Date().toISOString();return{...n,amount:parseFloat(n.amount)||0,type:i,category:m,date:o}}),safeUsers:a}},[y.transactions,y.users,y.customCategories]),{displayTxs:R,projectAllTxs:I,groupedTransactions:ee,monthlyTotal:C,settlement:f,currentProjectName:te,partnerName:O,otherUserId:se,dailyAverage:ae}=G.useMemo(()=>{const s=E.filter(t=>(t.projectId||"daily")===S),a=new Date;a.setDate(a.getDate()-7),a.setHours(0,0,0,0);const l=s.filter(t=>new Date(t.date)>=a),w=new Date().toISOString().slice(0,7),n=s.filter(t=>t.date.startsWith(w)),i={};[...l].sort((t,r)=>new Date(r.date)-new Date(t.date)).forEach(t=>{try{const r=new Date(t.date).toLocaleDateString("zh-TW");i[r]||(i[r]=[]),i[r].push(t)}catch{}});const o=k.rates||{},p=n.reduce((t,r)=>{const D=T(r.amount||0,r.currency||"TWD",o);return t+(isNaN(D)?0:D)},0),j=new Date().getDate(),W=j>0?p/j:p;let v=0,x=0;s.forEach(t=>{var D,H;if(t.isSettlement)return;const r=T(t.amount,t.currency||"TWD",o);if(!isNaN(r))if(t.splitType==="multi_payer"){let h=0;if(t.customSplit&&typeof t.customSplit=="object"){const z=t.customSplit[d.uid],q=parseFloat(z);isNaN(q)||(h=T(q,t.currency||"TWD",o))}const L=r/2;v+=h,x+=L}else{t.payer===d.uid&&(v+=r);let h=0;if(t.splitType==="even")h=r/2;else if(t.splitType==="custom"){if(t.customSplit&&typeof t.customSplit=="object"){const L=t.customSplit[d.uid],z=parseFloat(L);isNaN(z)||(h=T(z,t.currency||"TWD",o))}}else t.splitType==="host_all"?h=((D=g[d.uid])==null?void 0:D.role)==="host"?r:0:t.splitType==="guest_all"&&(h=((H=g[d.uid])==null?void 0:H.role)==="guest"?r:0);N&&(h=r),isNaN(h)||(x+=h)}});const $=E.filter(t=>t.isSettlement&&(t.projectId||"daily")===S);let F=0;$.forEach(t=>{const r=T(t.amount,t.currency||"TWD",o);isNaN(r)||(t.payer===d.uid?F+=r:F-=r)});const U=v-x+F,_=Object.keys(g).find(t=>t!==d.uid),re=_&&g[_]&&g[_].name||"å°æ–¹";return{displayTxs:l,projectAllTxs:s,groupedTransactions:i,monthlyTotal:isNaN(p)?0:p,settlement:isNaN(U)?0:U,currentProjectName:k.name||"æ—¥å¸¸é–‹éŠ·",partnerName:re,otherUserId:_,dailyAverage:W}},[E,g,S,d,k,N]),le=s=>{var n;if(N)return[];const a=[];if(s.isSettlement){const i=((n=g[s.payer])==null?void 0:n.name)||"æœªçŸ¥";return a.push({label:`${i} è½‰å¸³`,color:"gray"}),a}if(s.splitType==="multi_payer")return a.push({label:"æ··åˆå‡ºè³‡",color:"blue"}),a;const l=g[s.payer],w=(l==null?void 0:l.name)||"æœªçŸ¥";if(a.push({label:w,color:"gray"}),s.splitType==="custom"&&s.customSplit){const i=parseFloat(s.customSplit[s.payer]||0),m=parseFloat(s.amount||0);Math.abs(i-m)<.1?a.push({label:"ç§äºº",color:"gray"}):i<.1?a.push({label:"ä»£å¢Š",color:"gray"}):a.push({label:"è‡ªè¨‚åˆ†æ”¤",color:"gray"})}else if(s.splitType==="even")a.push({label:"å¹³å‡åˆ†æ”¤",color:"gray"});else{const i=l==null?void 0:l.role;i==="host"?s.splitType==="host_all"?a.push({label:"ç§äºº",color:"gray"}):s.splitType==="guest_all"&&a.push({label:"ä»£å¢Š",color:"gray"}):i==="guest"&&(s.splitType==="guest_all"?a.push({label:"ç§äºº",color:"gray"}):s.splitType==="host_all"&&a.push({label:"ä»£å¢Š",color:"gray"}))}return s.isSettled&&a.push({label:"å·²çµæ¸…",color:"green"}),a};return e.jsxs("div",{className:"pb-24 pt-[calc(env(safe-area-inset-top)+1rem)] px-4 relative",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:S,onChange:s=>B(s.target.value),className:`appearance-none text-white pl-4 pr-8 py-2 rounded-full font-bold text-sm outline-none shadow-lg shadow-gray-200 transition-colors ${N?"bg-gray-800":"bg-gray-900"}`,children:Z.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-white",children:e.jsx(ie,{size:14})})]}),e.jsxs("div",{className:"flex gap-2",children:[N&&e.jsx("div",{className:"p-2 bg-gray-100 rounded-full text-gray-400",children:e.jsx(oe,{size:16})}),e.jsx("button",{onClick:()=>J(!c),className:"p-2 bg-white rounded-full shadow-sm border border-gray-100 active:scale-95 transition-transform",children:c?e.jsx(ue,{size:16,className:"text-gray-400"}):e.jsx(fe,{size:16,className:"text-rose-500"})})]})]}),N?e.jsxs("div",{className:"rounded-3xl p-6 text-white shadow-lg shadow-gray-200 mb-8 relative overflow-hidden bg-gradient-to-br from-slate-700 to-gray-900",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white opacity-5 rounded-full -mr-10 -mt-10"}),e.jsxs("p",{className:"text-white/60 mb-1 font-bold text-xs flex items-center gap-2 uppercase tracking-wider",children:[e.jsx(ce,{size:12})," å€‹äººæ”¯å‡ºæ¦‚æ³"]}),e.jsx("div",{className:"flex justify-between items-end mb-4",children:e.jsx("h1",{className:"text-4xl font-bold tracking-tight truncate",title:u(C,"TWD",c),children:u(C,"TWD",c)})}),e.jsxs("div",{className:"flex gap-4 border-t border-white/10 pt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white/40 text-[10px] font-bold uppercase",children:"æœ¬æœˆç´¯è¨ˆ"}),e.jsx("p",{className:"text-sm font-medium",children:u(C,"TWD",c)})]}),e.jsx("div",{className:"w-[1px] h-8 bg-white/10"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/40 text-[10px] font-bold uppercase",children:"å¹³å‡æ—¥èŠ±è²»"}),e.jsx("p",{className:"text-sm font-medium truncate",children:u(ae,"TWD",c)})]})]})]}):e.jsxs("div",{className:`rounded-3xl p-6 text-white shadow-lg mb-8 relative overflow-hidden transition-colors ${f>=0?"bg-gradient-to-br from-emerald-500 to-teal-600 shadow-emerald-200":"bg-gradient-to-br from-rose-500 to-pink-600 shadow-rose-200"}`,children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -mr-10 -mt-10"}),e.jsxs("p",{className:"text-white/80 mb-1 font-medium text-sm flex items-center gap-2",children:[e.jsx(ye,{size:14})," ç¸½çµç®—ç‹€æ…‹ (",te,")"]}),e.jsx("div",{className:"flex justify-between items-end mb-2",children:e.jsx("h1",{className:"text-3xl font-bold tracking-tight flex items-center gap-2 flex-wrap",children:f>=0?e.jsxs(e.Fragment,{children:[e.jsx("span",{children:O})," ",e.jsx("span",{children:"æ¬ ä½ "})," ",e.jsx("span",{className:"truncate",children:u(Math.abs(f),"TWD",c)})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ä½ æ¬ "})," ",e.jsx("span",{children:O})," ",e.jsx("span",{className:"truncate",children:u(Math.abs(f),"TWD",c)})]})})}),e.jsxs("p",{className:"text-white/70 text-xs font-medium truncate",children:["æœ¬æœˆç¸½æ”¯å‡º: ",u(C,"TWD",c)]}),Math.abs(f)>0&&e.jsxs("button",{onClick:()=>X(Math.abs(f),f<0?O:"ä½ ",f<0?d.uid:se),className:"bg-white/20 hover:bg-white/30 text-white text-xs font-bold py-2 px-4 rounded-lg flex items-center gap-2 backdrop-blur-sm transition-colors mt-4",children:[e.jsx(V,{size:14})," çµæ¸…å‚µå‹™"]})]}),e.jsxs("div",{className:"space-y-6",children:[Object.entries(ee).map(([s,a])=>e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-3 ml-1",children:s}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-50 overflow-hidden",children:a.map((l,w)=>{var j,W,v;const n=de((j=l.category)==null?void 0:j.icon)||V,i=le(l),m=me(l.category,"display"),o=l.currency||"TWD",p=o!=="TWD",b=pe.find(x=>x.code===o);return e.jsxs("div",{onClick:()=>{Q(l),K(!0)},className:`flex items-center justify-between p-4 active:bg-gray-50 transition-colors ${w!==a.length-1?"border-b border-gray-50":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm shrink-0 ${m.containerClass}`,style:m.containerStyle,children:e.jsx(n,{size:16,className:m.iconClass,style:m.iconStyle})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-800 truncate text-sm",children:l.note||((W=l.category)==null?void 0:W.name)}),e.jsxs("div",{className:"flex items-center flex-wrap gap-1.5 mt-1",children:[e.jsx("p",{className:"text-xs text-gray-400 mr-1 shrink-0",children:(v=l.category)==null?void 0:v.name}),i.map((x,$)=>e.jsx("span",{className:`text-[10px] font-medium px-1.5 py-0.5 rounded border ${x.color==="green"?"bg-emerald-50 text-emerald-600 border-emerald-100":x.color==="blue"?"bg-blue-50 text-blue-600 border-blue-100":"bg-gray-100 text-gray-500 border-gray-100"}`,children:x.label},$))]})]})]}),e.jsxs("div",{className:"flex flex-col items-end ml-4",children:[e.jsxs("span",{className:`font-bold whitespace-nowrap flex items-center gap-1 max-w-[120px] justify-end ${l.isSettlement?"text-emerald-500":"text-gray-800"}`,children:[p&&e.jsx("span",{className:"text-[10px] saturate-50 opacity-80 mr-0.5 shrink-0",children:(b==null?void 0:b.flag)||o}),e.jsx("span",{className:"truncate",children:u(l.amount||0,o,c)})]}),p&&!c&&!l.isSettlement&&e.jsxs("span",{className:"text-[10px] text-gray-300 font-medium",children:["â‰ˆ ",u(T(l.amount,o,k.rates),"TWD")]})]})]},l.id)})})]},s)),I.length===0?e.jsxs("div",{className:"text-center py-10 text-gray-400",children:[e.jsx("p",{children:"é€™å€‹å°ˆæ¡ˆé‚„æ²’æœ‰è¨˜å¸³ç´€éŒ„å–” ğŸƒ"}),e.jsx("p",{className:"text-sm mt-2",children:"é»æ“Šä¸‹æ–¹ã€Œ+ã€é–‹å§‹ç¬¬ä¸€ç­†å§ï¼"})]}):R.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"æœ€è¿‘ 7 å¤©æ²’æœ‰æ”¯å‡º ğŸ‰"}),e.jsxs("button",{onClick:()=>M("stats"),className:"inline-flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-600 rounded-full text-xs font-bold hover:bg-gray-200 transition-colors",children:[e.jsx(Y,{size:14})," æŸ¥çœ‹æ­·å²ç´€éŒ„"]})]}):I.length>R.length?e.jsxs("div",{className:"text-center py-4 pb-8",children:[e.jsxs("button",{onClick:()=>M("stats"),className:"inline-flex items-center gap-2 px-5 py-2.5 bg-gray-50 text-gray-500 rounded-full text-sm font-bold border border-gray-100 hover:bg-white hover:border-gray-200 hover:text-rose-500 hover:shadow-sm transition-all",children:[e.jsx(Y,{size:16})," æŸ¥çœ‹æ›´å¤šæ­·å²ç´€éŒ„"]}),e.jsx("p",{className:"text-[10px] text-gray-300 mt-2",children:"é¦–é åƒ…é¡¯ç¤ºæœ€è¿‘ 7 å¤©çš„äº¤æ˜“"})]}):null]})]})}export{we as default};
